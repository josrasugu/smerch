{"ast":null,"code":"import _asyncToGenerator from \"C:\\\\node\\\\smerch-front\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";\nimport { SystConfig } from '../../config/syst';\nimport { HttpHeaders } from '@angular/common/http';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nconst _c0 = [\"canvasEl\"];\n\nfunction DesignComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵlistener(\"click\", function DesignComponent_div_4_Template_div_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const i_r5 = restoredCtx.index;\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.switchVariant(i_r5);\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const variant_r4 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", variant_r4.variant_id, \" \");\n  }\n}\n\nfunction DesignComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 11);\n  }\n\n  if (rf & 2) {\n    const color_r8 = ctx.$implicit;\n    const i_r9 = ctx.index;\n    i0.ɵɵstyleMapInterpolate1(\"background-color:\", color_r8, \";\");\n    i0.ɵɵpropertyInterpolate(\"id\", i_r9);\n    i0.ɵɵpropertyInterpolate(\"name\", i_r9);\n  }\n}\n\nfunction DesignComponent_button_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function DesignComponent_button_10_Template_button_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r12);\n      const template_r10 = restoredCtx.$implicit;\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.switchTemplate(template_r10.template_id);\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const template_r10 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", template_r10.placement, \" \");\n  }\n}\n\nexport class DesignComponent {\n  constructor(renderer, el, route, http) {\n    this.renderer = renderer;\n    this.el = el;\n    this.route = route;\n    this.http = http;\n    this.dragging = false;\n    this.designSelected = false;\n    this.resize = false;\n    this.resizeDrag = false;\n    this.lastX = 0;\n    this.lastY = 0;\n    this.marginLeft = 0;\n    this.marginTop = 0;\n    this.canvasoffsetLeft = 0;\n    this.canvasoffsetTop = 0;\n    this.placementX = 100;\n    this.placementY = 100;\n    this.designImgWidth = 0;\n    this.designImgHeight = 0;\n    this.designImgScale = 1;\n    this.variantColors = [];\n    this.variantSizes = [];\n    this.apiUrl = SystConfig.apiUrl;\n    this.apiPrintfulUrl = SystConfig.apiPrintfulUrl;\n    this.canvasEl = {};\n\n    this.getBase64FromUrl = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (url) {\n        const data = yield fetch(url);\n        const blob = yield data.blob();\n        return new Promise(resolve => {\n          const reader = new FileReader();\n          reader.readAsDataURL(blob);\n\n          reader.onloadend = () => {\n            const base64data = reader.result;\n            resolve(base64data);\n          };\n        });\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  }\n\n  genHeders(token_key) {\n    this.generatedHeader = {\n      headers: new HttpHeaders({\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n        'Authorization': token_key\n      })\n    };\n    return this.generatedHeader;\n  }\n\n  ngOnInit() {}\n\n  ngAfterViewInit() {\n    // console.log(this.template);\n    this.route.params.subscribe(params => {\n      this.getProduct(params['productId']).subscribe(val => {\n        this.serverData = val;\n        console.log(this.serverData.result.product);\n        console.log(this.serverData.result.variants);\n        let self = this;\n        this.serverData.result.variants.forEach(function (variant) {\n          var checkColorExist = false;\n          var checkSizeExist = false;\n\n          for (let c = 0; c < self.variantColors.length; c++) {\n            if (self.variantColors[c] == variant.color_code) {\n              checkColorExist = true;\n            }\n          }\n\n          for (let s = 0; s < self.variantSizes.length; s++) {\n            if (self.variantSizes[s] == variant.size) {\n              checkSizeExist = true;\n            }\n          }\n\n          if (!checkColorExist) {\n            self.variantColors.push(variant.color_code);\n          }\n\n          if (!checkSizeExist) {\n            self.variantSizes.push(variant.size);\n          }\n        });\n        console.log(this.variantColors, this.variantSizes); // variantColors\n        // variantSizes\n      }, response => {}, () => {// console.log(\"The observable is now completed.\");\n      });\n      this.getProductTemplates(params['productId']).subscribe(val => {\n        this.templatesData = val;\n        this.templates = this.templatesData.result.variant_mapping[0].templates;\n        this.variantId = this.templatesData.result.variant_mapping[0].variant_id;\n        var templateId = this.templatesData.result.variant_mapping[0].templates[0].template_id;\n        let self = this;\n        this.templatesData.result.templates.forEach(function (template) {\n          if (template.template_id == templateId) {\n            self.template = template;\n            self.templatePlacement(self.template.image_url, self.template.background_color);\n          }\n        });\n      }, response => {}, () => {// console.log(\"The observable is now completed.\");\n      }); // https://api.printful.com/products/362\n    });\n  }\n\n  templatePlacement(templateUrl, color) {\n    this.htmlEl = this.canvasEl.nativeElement;\n    this.htmlEl.width = 600;\n    this.htmlEl.height = 600;\n    this.getBase64FromUrl(templateUrl).then(b64Img => {\n      this.htmlEl.style.background = color + \" url('\" + b64Img + \"') left top/\" + 600 + \"px auto no-repeat\";\n      this.context = this.htmlEl.getContext('2d');\n      this.drawWindows();\n    });\n  }\n\n  switchVariant(variantIndex) {\n    // console.log(variantId);\n    this.templates = this.templatesData.result.variant_mapping[variantIndex].templates;\n    this.variantId = this.templatesData.result.variant_mapping[variantIndex].variant_id;\n    var templateId = this.templatesData.result.variant_mapping[variantIndex].templates[0].template_id;\n    let self = this;\n    this.templatesData.result.templates.forEach(function (template) {\n      if (template.template_id == templateId) {\n        self.template = template;\n        self.templatePlacement(self.template.image_url, self.template.background_color);\n      }\n    });\n  }\n\n  switchTemplate(templateId) {\n    // console.log(templateId);\n    let self = this;\n    this.templatesData.result.templates.forEach(function (template) {\n      if (template.template_id == templateId) {\n        self.template = template;\n        self.templatePlacement(self.template.image_url, self.template.background_color);\n      }\n    });\n  }\n\n  getProduct(id) {\n    var data = this.http.get(this.apiPrintfulUrl + '/products/' + id, this.genHeders('Bearer sWVhv4L9sI5PTh3VPRULd0pvYcMoQl3hWrrVegk0'));\n    return data;\n  }\n\n  getProductTemplates(productId) {\n    return this.http.post(this.apiPrintfulUrl + '/mockup-generator/templates/' + productId, {\n      \"store_id\": 8410045\n    }, this.genHeders('Bearer sWVhv4L9sI5PTh3VPRULd0pvYcMoQl3hWrrVegk0'));\n  }\n\n  mouseDown(e) {\n    if (this.resize) {\n      this.dragging = false;\n      this.resizeDrag = true;\n    } else {\n      this.dragging = true;\n      this.resizeDrag = false;\n    }\n\n    const rect = this.htmlEl.getBoundingClientRect();\n    var mx = Math.floor(e.clientX - rect.left);\n    var my = Math.floor(e.clientY - rect.top); // console.log(mx, my);\n    // var evt = e || event;\n    // console.log(evt.clientX, evt.clientY);\n\n    this.designSelect(mx, my);\n  }\n\n  mouseUp(e) {\n    this.dragging = false;\n    this.resizeDrag = false;\n  }\n\n  onMouseMove(e) {\n    var evt = e || event;\n    var deltaX = evt.clientX - this.lastX;\n    var deltaY = evt.clientY - this.lastY;\n    this.lastX = evt.clientX;\n    this.lastY = evt.clientY;\n\n    if (this.dragging) {\n      // console.log(\"Mouse move\");\n      this.placementX += deltaX;\n      this.placementY += deltaY;\n      this.drawWindows();\n    }\n\n    if (this.designSelected) {\n      const rect = this.htmlEl.getBoundingClientRect();\n      var mx = Math.floor(e.clientX - rect.left);\n      var my = Math.floor(e.clientY - rect.top);\n\n      if (!this.resizeDrag) {\n        this.resize = this.inDrawing(mx, my, [this.placementX + this.designImgWidth * this.designImgScale - 10, this.placementY + this.designImgHeight * this.designImgScale - 10, this.placementX + this.designImgWidth * this.designImgScale, this.placementY + this.designImgHeight * this.designImgScale]);\n      } // console.log(this.resize);\n\n\n      if (this.resize) {\n        this.htmlEl.style.cursor = \"nw-resize\";\n      } else {\n        this.htmlEl.style.cursor = \"default\";\n      }\n    }\n\n    if (this.resize == true && this.resizeDrag == true) {\n      // console.log(deltaX,deltaY);\n      this.designImgWidth += deltaX;\n      this.designImgHeight += deltaY;\n      this.drawWindows();\n    } // const rect = this.htmlEl.getBoundingClientRect();\n\n  }\n\n  drawWindows() {\n    this.context.clearRect(0, 0, 800, 700);\n    var img = new Image();\n    let self = this;\n    /*    img.onload = function() {\r\n          self.context.drawImage(img, self.placementX, self.placementY, 200, 100);\r\n        };*/\n\n    img.addEventListener(\"load\", function () {\n      if (self.resize) {\n        self.paintSelect();\n      } else {\n        if (self.designImgWidth == 0 && self.designImgHeight == 0) {\n          self.designImgWidth = this.naturalWidth;\n          self.designImgHeight = this.naturalHeight;\n        }\n      }\n\n      self.context.drawImage(img, self.placementX, self.placementY, self.designImgWidth * self.designImgScale, self.designImgHeight * self.designImgScale);\n    });\n    img.src = '/assets/imgs/smerch-logo.png';\n  }\n\n  designSelect(x, y) {\n    // console.log(this.placementX,this.placementY,this.designImgScale);\n    // var checkPoint = inDrawing(x,y,[minX, minY, maxX, maxY]);\n    var checkPoint = this.inDrawing(x, y, [this.placementX, this.placementY, this.placementX + this.designImgWidth * this.designImgScale, this.placementY + this.designImgHeight * this.designImgScale]); // console.log(checkPoint);\n\n    if (checkPoint) {\n      this.designSelected = true;\n      this.paintSelect();\n    } else {\n      this.designSelected = false;\n    }\n  }\n\n  paintSelect() {\n    this.context.setLineDash([6]);\n    this.context.strokeRect(this.placementX, this.placementY, this.designImgWidth * this.designImgScale, this.designImgHeight * this.designImgScale);\n    this.context.fillRect(this.placementX + this.designImgWidth * this.designImgScale - 10, this.placementY + this.designImgHeight * this.designImgScale - 10, 10, 10);\n  }\n\n  inDrawing(x, y, rect) {\n    if (x >= rect['0'] && x <= rect['2'] && y >= rect['1'] && y <= rect['3']) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n}\n\nDesignComponent.ɵfac = function DesignComponent_Factory(t) {\n  return new (t || DesignComponent)(i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.HttpClient));\n};\n\nDesignComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: DesignComponent,\n  selectors: [[\"app-design\"]],\n  viewQuery: function DesignComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5);\n    }\n\n    if (rf & 2) {\n      let _t;\n\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.canvasEl = _t.first);\n    }\n  },\n  decls: 13,\n  vars: 3,\n  consts: [[1, \"container\"], [1, \"row\"], [1, \"col-md-6\", \"col-sm-6\"], [\"class\", \"col-md-6\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"action\", \"/action_page.php\"], [\"value\", \"Bike\", 3, \"id\", \"name\", \"style\", 4, \"ngFor\", \"ngForOf\"], [1, \"col-12\", 2, \"margin-bottom\", \"20px\"], [\"class\", \"btn btn-sm\", \"style\", \"float: left\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [2, \"background\", \"#f5f5f5\", \"border\", \"1px solid #ccc\", 3, \"mousedown\", \"mouseup\", \"mousemove\"], [\"canvasEl\", \"\"], [1, \"col-md-6\", 3, \"click\"], [\"value\", \"Bike\", 3, \"id\", \"name\"], [1, \"btn\", \"btn-sm\", 2, \"float\", \"left\", 3, \"click\"]],\n  template: function DesignComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 1);\n      i0.ɵɵtemplate(4, DesignComponent_div_4_Template, 2, 1, \"div\", 3);\n      i0.ɵɵelementStart(5, \"form\", 4);\n      i0.ɵɵtemplate(6, DesignComponent_div_6_Template, 1, 5, \"div\", 5);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(7, \"div\", 2)(8, \"div\", 1)(9, \"div\", 6);\n      i0.ɵɵtemplate(10, DesignComponent_button_10_Template, 2, 1, \"button\", 7);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(11, \"canvas\", 8, 9);\n      i0.ɵɵlistener(\"mousedown\", function DesignComponent_Template_canvas_mousedown_11_listener($event) {\n        return ctx.mouseDown($event);\n      })(\"mouseup\", function DesignComponent_Template_canvas_mouseup_11_listener($event) {\n        return ctx.mouseUp($event);\n      })(\"mousemove\", function DesignComponent_Template_canvas_mousemove_11_listener($event) {\n        return ctx.onMouseMove($event);\n      });\n      i0.ɵɵelementEnd()()()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngForOf\", ctx.templatesData == null ? null : ctx.templatesData.result.variant_mapping);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngForOf\", ctx.variantColors);\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngForOf\", ctx.templates);\n    }\n  },\n  directives: [i3.NgForOf, i4.ɵNgNoValidate, i4.NgControlStatusGroup, i4.NgForm],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJkZXNpZ24uY29tcG9uZW50LmNzcyJ9 */\"]\n});","map":{"version":3,"sources":["C:/node/smerch-front/src/app/mockup-design/design/design.component.ts"],"names":["SystConfig","HttpHeaders","i0","i1","i2","i3","i4","_c0","DesignComponent_div_4_Template","rf","ctx","_r7","ɵɵgetCurrentView","ɵɵelementStart","ɵɵlistener","DesignComponent_div_4_Template_div_click_0_listener","restoredCtx","ɵɵrestoreView","i_r5","index","ctx_r6","ɵɵnextContext","switchVariant","ɵɵtext","ɵɵelementEnd","variant_r4","$implicit","ɵɵadvance","ɵɵtextInterpolate1","variant_id","DesignComponent_div_6_Template","ɵɵelement","color_r8","i_r9","ɵɵstyleMapInterpolate1","ɵɵpropertyInterpolate","DesignComponent_button_10_Template","_r12","DesignComponent_button_10_Template_button_click_0_listener","template_r10","ctx_r11","switchTemplate","template_id","placement","DesignComponent","constructor","renderer","el","route","http","dragging","designSelected","resize","resizeDrag","lastX","lastY","marginLeft","marginTop","canvasoffsetLeft","canvasoffsetTop","placementX","placementY","designImgWidth","designImgHeight","designImgScale","variantColors","variantSizes","apiUrl","apiPrintfulUrl","canvasEl","getBase64FromUrl","url","data","fetch","blob","Promise","resolve","reader","FileReader","readAsDataURL","onloadend","base64data","result","genHeders","token_key","generatedHeader","headers","ngOnInit","ngAfterViewInit","params","subscribe","getProduct","val","serverData","console","log","product","variants","self","forEach","variant","checkColorExist","checkSizeExist","c","length","color_code","s","size","push","response","getProductTemplates","templatesData","templates","variant_mapping","variantId","templateId","template","templatePlacement","image_url","background_color","templateUrl","color","htmlEl","nativeElement","width","height","then","b64Img","style","background","context","getContext","drawWindows","variantIndex","id","get","productId","post","mouseDown","e","rect","getBoundingClientRect","mx","Math","floor","clientX","left","my","clientY","top","designSelect","mouseUp","onMouseMove","evt","event","deltaX","deltaY","inDrawing","cursor","clearRect","img","Image","addEventListener","paintSelect","naturalWidth","naturalHeight","drawImage","src","x","y","checkPoint","setLineDash","strokeRect","fillRect","ɵfac","DesignComponent_Factory","t","ɵɵdirectiveInject","Renderer2","ElementRef","ActivatedRoute","HttpClient","ɵcmp","ɵɵdefineComponent","type","selectors","viewQuery","DesignComponent_Query","ɵɵviewQuery","_t","ɵɵqueryRefresh","ɵɵloadQuery","first","decls","vars","consts","DesignComponent_Template","ɵɵtemplate","DesignComponent_Template_canvas_mousedown_11_listener","$event","DesignComponent_Template_canvas_mouseup_11_listener","DesignComponent_Template_canvas_mousemove_11_listener","ɵɵproperty","directives","NgForOf","ɵNgNoValidate","NgControlStatusGroup","NgForm","styles"],"mappings":"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","sourcesContent":["import { SystConfig } from '../../config/syst';\r\nimport { HttpHeaders } from '@angular/common/http';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/router\";\r\nimport * as i2 from \"@angular/common/http\";\r\nimport * as i3 from \"@angular/common\";\r\nimport * as i4 from \"@angular/forms\";\r\nconst _c0 = [\"canvasEl\"];\r\nfunction DesignComponent_div_4_Template(rf, ctx) { if (rf & 1) {\r\n    const _r7 = i0.ɵɵgetCurrentView();\r\n    i0.ɵɵelementStart(0, \"div\", 10);\r\n    i0.ɵɵlistener(\"click\", function DesignComponent_div_4_Template_div_click_0_listener() { const restoredCtx = i0.ɵɵrestoreView(_r7); const i_r5 = restoredCtx.index; const ctx_r6 = i0.ɵɵnextContext(); return ctx_r6.switchVariant(i_r5); });\r\n    i0.ɵɵtext(1);\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const variant_r4 = ctx.$implicit;\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵtextInterpolate1(\" \", variant_r4.variant_id, \" \");\r\n} }\r\nfunction DesignComponent_div_6_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelement(0, \"div\", 11);\r\n} if (rf & 2) {\r\n    const color_r8 = ctx.$implicit;\r\n    const i_r9 = ctx.index;\r\n    i0.ɵɵstyleMapInterpolate1(\"background-color:\", color_r8, \";\");\r\n    i0.ɵɵpropertyInterpolate(\"id\", i_r9);\r\n    i0.ɵɵpropertyInterpolate(\"name\", i_r9);\r\n} }\r\nfunction DesignComponent_button_10_Template(rf, ctx) { if (rf & 1) {\r\n    const _r12 = i0.ɵɵgetCurrentView();\r\n    i0.ɵɵelementStart(0, \"button\", 12);\r\n    i0.ɵɵlistener(\"click\", function DesignComponent_button_10_Template_button_click_0_listener() { const restoredCtx = i0.ɵɵrestoreView(_r12); const template_r10 = restoredCtx.$implicit; const ctx_r11 = i0.ɵɵnextContext(); return ctx_r11.switchTemplate(template_r10.template_id); });\r\n    i0.ɵɵtext(1);\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const template_r10 = ctx.$implicit;\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵtextInterpolate1(\" \", template_r10.placement, \" \");\r\n} }\r\nexport class DesignComponent {\r\n    constructor(renderer, el, route, http) {\r\n        this.renderer = renderer;\r\n        this.el = el;\r\n        this.route = route;\r\n        this.http = http;\r\n        this.dragging = false;\r\n        this.designSelected = false;\r\n        this.resize = false;\r\n        this.resizeDrag = false;\r\n        this.lastX = 0;\r\n        this.lastY = 0;\r\n        this.marginLeft = 0;\r\n        this.marginTop = 0;\r\n        this.canvasoffsetLeft = 0;\r\n        this.canvasoffsetTop = 0;\r\n        this.placementX = 100;\r\n        this.placementY = 100;\r\n        this.designImgWidth = 0;\r\n        this.designImgHeight = 0;\r\n        this.designImgScale = 1;\r\n        this.variantColors = [];\r\n        this.variantSizes = [];\r\n        this.apiUrl = SystConfig.apiUrl;\r\n        this.apiPrintfulUrl = SystConfig.apiPrintfulUrl;\r\n        this.canvasEl = {};\r\n        this.getBase64FromUrl = async (url) => {\r\n            const data = await fetch(url);\r\n            const blob = await data.blob();\r\n            return new Promise((resolve) => {\r\n                const reader = new FileReader();\r\n                reader.readAsDataURL(blob);\r\n                reader.onloadend = () => {\r\n                    const base64data = reader.result;\r\n                    resolve(base64data);\r\n                };\r\n            });\r\n        };\r\n    }\r\n    genHeders(token_key) {\r\n        this.generatedHeader = {\r\n            headers: new HttpHeaders({\r\n                'Content-Type': 'application/json',\r\n                'Access-Control-Allow-Origin': '*',\r\n                'Authorization': token_key,\r\n            })\r\n        };\r\n        return this.generatedHeader;\r\n    }\r\n    ngOnInit() {\r\n    }\r\n    ngAfterViewInit() {\r\n        // console.log(this.template);\r\n        this.route.params.subscribe(params => {\r\n            this.getProduct(params['productId']).subscribe((val) => {\r\n                this.serverData = val;\r\n                console.log(this.serverData.result.product);\r\n                console.log(this.serverData.result.variants);\r\n                let self = this;\r\n                this.serverData.result.variants.forEach(function (variant) {\r\n                    var checkColorExist = false;\r\n                    var checkSizeExist = false;\r\n                    for (let c = 0; c < self.variantColors.length; c++) {\r\n                        if (self.variantColors[c] == variant.color_code) {\r\n                            checkColorExist = true;\r\n                        }\r\n                    }\r\n                    for (let s = 0; s < self.variantSizes.length; s++) {\r\n                        if (self.variantSizes[s] == variant.size) {\r\n                            checkSizeExist = true;\r\n                        }\r\n                    }\r\n                    if (!checkColorExist) {\r\n                        self.variantColors.push(variant.color_code);\r\n                    }\r\n                    if (!checkSizeExist) {\r\n                        self.variantSizes.push(variant.size);\r\n                    }\r\n                });\r\n                console.log(this.variantColors, this.variantSizes);\r\n                // variantColors\r\n                // variantSizes\r\n            }, response => {\r\n            }, () => {\r\n                // console.log(\"The observable is now completed.\");\r\n            });\r\n            this.getProductTemplates(params['productId']).subscribe((val) => {\r\n                this.templatesData = val;\r\n                this.templates = this.templatesData.result.variant_mapping[0].templates;\r\n                this.variantId = this.templatesData.result.variant_mapping[0].variant_id;\r\n                var templateId = this.templatesData.result.variant_mapping[0].templates[0].template_id;\r\n                let self = this;\r\n                this.templatesData.result.templates.forEach(function (template) {\r\n                    if (template.template_id == templateId) {\r\n                        self.template = template;\r\n                        self.templatePlacement(self.template.image_url, self.template.background_color);\r\n                    }\r\n                });\r\n            }, response => {\r\n            }, () => {\r\n                // console.log(\"The observable is now completed.\");\r\n            });\r\n            // https://api.printful.com/products/362\r\n        });\r\n    }\r\n    templatePlacement(templateUrl, color) {\r\n        this.htmlEl = this.canvasEl.nativeElement;\r\n        this.htmlEl.width = 600;\r\n        this.htmlEl.height = 600;\r\n        this.getBase64FromUrl(templateUrl).then((b64Img) => {\r\n            this.htmlEl.style.background = color + \" url('\" + b64Img + \"') left top/\" + 600 + \"px auto no-repeat\";\r\n            this.context = this.htmlEl.getContext('2d');\r\n            this.drawWindows();\r\n        });\r\n    }\r\n    switchVariant(variantIndex) {\r\n        // console.log(variantId);\r\n        this.templates = this.templatesData.result.variant_mapping[variantIndex].templates;\r\n        this.variantId = this.templatesData.result.variant_mapping[variantIndex].variant_id;\r\n        var templateId = this.templatesData.result.variant_mapping[variantIndex].templates[0].template_id;\r\n        let self = this;\r\n        this.templatesData.result.templates.forEach(function (template) {\r\n            if (template.template_id == templateId) {\r\n                self.template = template;\r\n                self.templatePlacement(self.template.image_url, self.template.background_color);\r\n            }\r\n        });\r\n    }\r\n    switchTemplate(templateId) {\r\n        // console.log(templateId);\r\n        let self = this;\r\n        this.templatesData.result.templates.forEach(function (template) {\r\n            if (template.template_id == templateId) {\r\n                self.template = template;\r\n                self.templatePlacement(self.template.image_url, self.template.background_color);\r\n            }\r\n        });\r\n    }\r\n    getProduct(id) {\r\n        var data = this.http.get(this.apiPrintfulUrl + '/products/' + id, this.genHeders('Bearer sWVhv4L9sI5PTh3VPRULd0pvYcMoQl3hWrrVegk0'));\r\n        return data;\r\n    }\r\n    getProductTemplates(productId) {\r\n        return this.http.post(this.apiPrintfulUrl + '/mockup-generator/templates/' + productId, { \"store_id\": 8410045 }, this.genHeders('Bearer sWVhv4L9sI5PTh3VPRULd0pvYcMoQl3hWrrVegk0'));\r\n    }\r\n    mouseDown(e) {\r\n        if (this.resize) {\r\n            this.dragging = false;\r\n            this.resizeDrag = true;\r\n        }\r\n        else {\r\n            this.dragging = true;\r\n            this.resizeDrag = false;\r\n        }\r\n        const rect = this.htmlEl.getBoundingClientRect();\r\n        var mx = Math.floor(e.clientX - rect.left);\r\n        var my = Math.floor(e.clientY - rect.top);\r\n        // console.log(mx, my);\r\n        // var evt = e || event;\r\n        // console.log(evt.clientX, evt.clientY);\r\n        this.designSelect(mx, my);\r\n    }\r\n    mouseUp(e) {\r\n        this.dragging = false;\r\n        this.resizeDrag = false;\r\n    }\r\n    onMouseMove(e) {\r\n        var evt = e || event;\r\n        var deltaX = evt.clientX - this.lastX;\r\n        var deltaY = evt.clientY - this.lastY;\r\n        this.lastX = evt.clientX;\r\n        this.lastY = evt.clientY;\r\n        if (this.dragging) {\r\n            // console.log(\"Mouse move\");\r\n            this.placementX += deltaX;\r\n            this.placementY += deltaY;\r\n            this.drawWindows();\r\n        }\r\n        if (this.designSelected) {\r\n            const rect = this.htmlEl.getBoundingClientRect();\r\n            var mx = Math.floor(e.clientX - rect.left);\r\n            var my = Math.floor(e.clientY - rect.top);\r\n            if (!this.resizeDrag) {\r\n                this.resize = this.inDrawing(mx, my, [this.placementX + (this.designImgWidth * this.designImgScale) - 10, this.placementY + (this.designImgHeight * this.designImgScale) - 10, this.placementX + (this.designImgWidth * this.designImgScale), this.placementY + (this.designImgHeight * this.designImgScale)]);\r\n            }\r\n            // console.log(this.resize);\r\n            if (this.resize) {\r\n                this.htmlEl.style.cursor = \"nw-resize\";\r\n            }\r\n            else {\r\n                this.htmlEl.style.cursor = \"default\";\r\n            }\r\n        }\r\n        if (this.resize == true && this.resizeDrag == true) {\r\n            // console.log(deltaX,deltaY);\r\n            this.designImgWidth += deltaX;\r\n            this.designImgHeight += deltaY;\r\n            this.drawWindows();\r\n        }\r\n        // const rect = this.htmlEl.getBoundingClientRect();\r\n    }\r\n    drawWindows() {\r\n        this.context.clearRect(0, 0, 800, 700);\r\n        var img = new Image();\r\n        let self = this;\r\n        /*    img.onload = function() {\r\n              self.context.drawImage(img, self.placementX, self.placementY, 200, 100);\r\n            };*/\r\n        img.addEventListener(\"load\", function () {\r\n            if (self.resize) {\r\n                self.paintSelect();\r\n            }\r\n            else {\r\n                if (self.designImgWidth == 0 && self.designImgHeight == 0) {\r\n                    self.designImgWidth = this.naturalWidth;\r\n                    self.designImgHeight = this.naturalHeight;\r\n                }\r\n            }\r\n            self.context.drawImage(img, self.placementX, self.placementY, self.designImgWidth * self.designImgScale, self.designImgHeight * self.designImgScale);\r\n        });\r\n        img.src = '/assets/imgs/smerch-logo.png';\r\n    }\r\n    designSelect(x, y) {\r\n        // console.log(this.placementX,this.placementY,this.designImgScale);\r\n        // var checkPoint = inDrawing(x,y,[minX, minY, maxX, maxY]);\r\n        var checkPoint = this.inDrawing(x, y, [this.placementX, this.placementY, this.placementX + (this.designImgWidth * this.designImgScale), this.placementY + (this.designImgHeight * this.designImgScale)]);\r\n        // console.log(checkPoint);\r\n        if (checkPoint) {\r\n            this.designSelected = true;\r\n            this.paintSelect();\r\n        }\r\n        else {\r\n            this.designSelected = false;\r\n        }\r\n    }\r\n    paintSelect() {\r\n        this.context.setLineDash([6]);\r\n        this.context.strokeRect(this.placementX, this.placementY, (this.designImgWidth * this.designImgScale), (this.designImgHeight * this.designImgScale));\r\n        this.context.fillRect(this.placementX + (this.designImgWidth * this.designImgScale) - 10, this.placementY + (this.designImgHeight * this.designImgScale) - 10, 10, 10);\r\n    }\r\n    inDrawing(x, y, rect) {\r\n        if (x >= rect['0'] && x <= rect['2'] && y >= rect['1'] && y <= rect['3']) {\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n}\r\nDesignComponent.ɵfac = function DesignComponent_Factory(t) { return new (t || DesignComponent)(i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.HttpClient)); };\r\nDesignComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: DesignComponent, selectors: [[\"app-design\"]], viewQuery: function DesignComponent_Query(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵviewQuery(_c0, 5);\r\n    } if (rf & 2) {\r\n        let _t;\r\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.canvasEl = _t.first);\r\n    } }, decls: 13, vars: 3, consts: [[1, \"container\"], [1, \"row\"], [1, \"col-md-6\", \"col-sm-6\"], [\"class\", \"col-md-6\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"action\", \"/action_page.php\"], [\"value\", \"Bike\", 3, \"id\", \"name\", \"style\", 4, \"ngFor\", \"ngForOf\"], [1, \"col-12\", 2, \"margin-bottom\", \"20px\"], [\"class\", \"btn btn-sm\", \"style\", \"float: left\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [2, \"background\", \"#f5f5f5\", \"border\", \"1px solid #ccc\", 3, \"mousedown\", \"mouseup\", \"mousemove\"], [\"canvasEl\", \"\"], [1, \"col-md-6\", 3, \"click\"], [\"value\", \"Bike\", 3, \"id\", \"name\"], [1, \"btn\", \"btn-sm\", 2, \"float\", \"left\", 3, \"click\"]], template: function DesignComponent_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 1);\r\n        i0.ɵɵtemplate(4, DesignComponent_div_4_Template, 2, 1, \"div\", 3);\r\n        i0.ɵɵelementStart(5, \"form\", 4);\r\n        i0.ɵɵtemplate(6, DesignComponent_div_6_Template, 1, 5, \"div\", 5);\r\n        i0.ɵɵelementEnd()()();\r\n        i0.ɵɵelementStart(7, \"div\", 2)(8, \"div\", 1)(9, \"div\", 6);\r\n        i0.ɵɵtemplate(10, DesignComponent_button_10_Template, 2, 1, \"button\", 7);\r\n        i0.ɵɵelementEnd()();\r\n        i0.ɵɵelementStart(11, \"canvas\", 8, 9);\r\n        i0.ɵɵlistener(\"mousedown\", function DesignComponent_Template_canvas_mousedown_11_listener($event) { return ctx.mouseDown($event); })(\"mouseup\", function DesignComponent_Template_canvas_mouseup_11_listener($event) { return ctx.mouseUp($event); })(\"mousemove\", function DesignComponent_Template_canvas_mousemove_11_listener($event) { return ctx.onMouseMove($event); });\r\n        i0.ɵɵelementEnd()()()();\r\n    } if (rf & 2) {\r\n        i0.ɵɵadvance(4);\r\n        i0.ɵɵproperty(\"ngForOf\", ctx.templatesData == null ? null : ctx.templatesData.result.variant_mapping);\r\n        i0.ɵɵadvance(2);\r\n        i0.ɵɵproperty(\"ngForOf\", ctx.variantColors);\r\n        i0.ɵɵadvance(4);\r\n        i0.ɵɵproperty(\"ngForOf\", ctx.templates);\r\n    } }, directives: [i3.NgForOf, i4.ɵNgNoValidate, i4.NgControlStatusGroup, i4.NgForm], styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJkZXNpZ24uY29tcG9uZW50LmNzcyJ9 */\"] });\r\n"]},"metadata":{},"sourceType":"module"}